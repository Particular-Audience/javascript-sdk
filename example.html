<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Particular Audience SDK Example</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1, h2 {
            color: #333;
        }
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .product-card {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            background: white;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .product-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        .product-image {
            width: 100%;
            height: 150px;
            background: #f0f0f0;
            border-radius: 4px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
        }
        .product-name {
            font-weight: 600;
            margin-bottom: 5px;
        }
        .product-price {
            color: #2196F3;
            font-size: 18px;
        }
        .button {
            background: #2196F3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
            margin-top: 10px;
        }
        .button:hover {
            background: #1976D2;
        }
        .button.secondary {
            background: #757575;
        }
        .button.secondary:hover {
            background: #616161;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
            font-size: 14px;
        }
        .status.success {
            background: #E8F5E9;
            color: #2E7D32;
        }
        .status.error {
            background: #FFEBEE;
            color: #C62828;
        }
        .recommendation-widget {
            border: 2px dashed #2196F3;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
        }
        .recommendation-header {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #1976D2;
        }
        pre {
            background: #f4f4f4;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }
        .console-log {
            background: #263238;
            color: #ECEFF1;
            padding: 10px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 10px;
        }
        .log-entry {
            margin-bottom: 5px;
        }
        .log-time {
            color: #78909C;
        }
        .log-type {
            font-weight: bold;
        }
        .log-type.info { color: #81C784; }
        .log-type.error { color: #EF5350; }
        .log-type.event { color: #FFB74D; }
    </style>
</head>
<body>
    <h1>Particular Audience SDK Example</h1>

    <div class="section">
        <h2>SDK Initialization</h2>
        <p>The SDK is initialized with your backend proxy URL and configuration options.</p>
        <button class="button" onclick="initializeSDK()">Initialize SDK</button>
        <button class="button secondary" onclick="checkSession()">Check Session</button>
        <div id="init-status"></div>
    </div>

    <div class="section">
        <h2>Sample Products</h2>
        <p>Click on products to simulate product views and interactions.</p>
        <div class="product-grid" id="sample-products">
            <!-- Products will be inserted here -->
        </div>
    </div>

    <div class="section">
        <h2>Recommendations</h2>
        <p>Get personalized product recommendations based on current context.</p>
        <button class="button" onclick="getRecommendations()">Get Recommendations</button>
        <button class="button secondary" onclick="getRecommendationsWithProduct()">Get Similar Products</button>
        <div class="recommendation-widget" id="recommendations" style="display: none;">
            <div class="recommendation-header">Recommended For You</div>
            <div class="product-grid" id="recommendation-products"></div>
        </div>
    </div>

    <div class="section">
        <h2>Event Tracking Examples</h2>
        <p>Test various event tracking methods.</p>
        
        <h3>E-commerce Events</h3>
        <button class="button" onclick="trackProductView()">Track Product View</button>
        <button class="button" onclick="trackAddToCart()">Track Add to Cart</button>
        <button class="button" onclick="trackCheckout()">Track Checkout</button>
        <button class="button" onclick="trackPurchase()">Track Purchase</button>
        
        <h3>Interaction Events</h3>
        <button class="button" onclick="trackSearch()">Track Search</button>
        <button class="button" onclick="trackClick()">Track Click</button>
        <button class="button" onclick="trackImpression()">Track Impression</button>
    </div>

    <div class="section">
        <h2>Console Output</h2>
        <p>SDK activity and events are logged here:</p>
        <div class="console-log" id="console-output"></div>
    </div>

    <script src="pa-sdk.js"></script>
    <script>
        let paSDK = null;
        const consoleLog = [];

        // Sample products for demonstration
        const sampleProducts = [
            { refId: 'PROD-001', name: 'Wireless Headphones', price: 79.99, category: 'Electronics' },
            { refId: 'PROD-002', name: 'Smart Watch', price: 249.99, category: 'Electronics' },
            { refId: 'PROD-003', name: 'Running Shoes', price: 89.99, category: 'Sports' },
            { refId: 'PROD-004', name: 'Yoga Mat', price: 29.99, category: 'Sports' },
            { refId: 'PROD-005', name: 'Coffee Maker', price: 149.99, category: 'Home' },
            { refId: 'PROD-006', name: 'Desk Lamp', price: 39.99, category: 'Home' }
        ];

        // Initialize sample products
        function initializeSampleProducts() {
            const container = document.getElementById('sample-products');
            container.innerHTML = sampleProducts.map(product => `
                <div class="product-card" 
                     onclick="selectProduct('${product.refId}')"
                     data-pa-track-click
                     data-pa-ref-id="${product.refId}"
                     data-pa-action-type="1"
                     data-pa-context-type="1">
                    <div class="product-image">Image</div>
                    <div class="product-name">${product.name}</div>
                    <div class="product-price">$${product.price}</div>
                    <button class="button" onclick="event.stopPropagation(); addToCart('${product.refId}', ${product.price})">
                        Add to Cart
                    </button>
                </div>
            `).join('');
        }

        // Initialize SDK
        async function initializeSDK() {
            try {
                logToConsole('info', 'Initializing SDK...');
                
                // Initialize with your proxy configuration
                paSDK = new ParticularAudience({
                    proxyUrl: '/api/pa',  // Your backend proxy endpoint
                    enableLogging: true,
                    autoTrackProductViews: true,
                    autoTrackClicks: true,
                    autoTrackImpressions: true
                });

                // Wait a moment for initialization
                await new Promise(resolve => setTimeout(resolve, 1000));

                document.getElementById('init-status').innerHTML = 
                    '<div class="status success">SDK initialized successfully</div>';
                
                logToConsole('info', 'SDK initialized with session:', paSDK.session);
            } catch (error) {
                document.getElementById('init-status').innerHTML = 
                    '<div class="status error">Failed to initialize SDK: ' + error.message + '</div>';
                logToConsole('error', 'SDK initialization failed:', error);
            }
        }

        // Check current session
        function checkSession() {
            if (!paSDK) {
                alert('Please initialize SDK first');
                return;
            }
            
            const session = paSDK.session;
            logToConsole('info', 'Current session:', session);
            alert(`Session Info:\nCustomer ID: ${session.customerId}\nSession ID: ${session.sessionId}\nControl Cohort: ${session.controlCohort}`);
        }

        // Get recommendations
        async function getRecommendations() {
            if (!paSDK) {
                alert('Please initialize SDK first');
                return;
            }

            try {
                logToConsole('info', 'Fetching recommendations...');
                
                const recommendations = await paSDK.getRecommendations({
                    currentUrl: window.location.href,
                    expandProductDetails: true,
                    showInStockOnly: true
                });

                displayRecommendations(recommendations);
                logToConsole('info', 'Recommendations received:', recommendations);
            } catch (error) {
                logToConsole('error', 'Failed to get recommendations:', error);
                alert('Failed to get recommendations: ' + error.message);
            }
        }

        // Get recommendations for specific product
        async function getRecommendationsWithProduct() {
            if (!paSDK) {
                alert('Please initialize SDK first');
                return;
            }

            const productId = prompt('Enter product ID (e.g., PROD-001):');
            if (!productId) return;

            try {
                logToConsole('info', `Fetching recommendations for product ${productId}...`);
                
                const recommendations = await paSDK.getRecommendations({
                    currentUrl: window.location.href,
                    refId: productId,
                    expandProductDetails: true
                });

                displayRecommendations(recommendations);
                logToConsole('info', 'Product recommendations received:', recommendations);
            } catch (error) {
                logToConsole('error', 'Failed to get product recommendations:', error);
                alert('Failed to get recommendations: ' + error.message);
            }
        }

        // Display recommendations
        function displayRecommendations(recommendations) {
            const widget = document.getElementById('recommendations');
            const container = document.getElementById('recommendation-products');
            
            if (recommendations?.recommendations?.route?.widgets?.[0]?.slots?.[0]?.products) {
                const products = recommendations.recommendations.route.widgets[0].slots[0].products;
                
                container.innerHTML = products.map(product => `
                    <div class="product-card">
                        <div class="product-image">Recommended</div>
                        <div class="product-name">${product.name || product.refId}</div>
                        <div class="product-price">${product.prices?.[0] ? '$' + product.prices[0].price : 'N/A'}</div>
                    </div>
                `).join('');
                
                widget.style.display = 'block';
            } else {
                container.innerHTML = '<p>No recommendations available</p>';
                widget.style.display = 'block';
            }
        }

        // Track product view
        async function trackProductView() {
            if (!paSDK) {
                alert('Please initialize SDK first');
                return;
            }

            const productId = prompt('Enter product ID to track (e.g., PROD-001):') || 'PROD-001';
            
            try {
                await paSDK.trackViewProduct({
                    refId: productId,
                    widgetId: 'widget-123',
                    routeId: 'route-456'
                });
                
                logToConsole('event', `Product view tracked: ${productId}`);
                alert('Product view tracked successfully!');
            } catch (error) {
                logToConsole('error', 'Failed to track product view:', error);
            }
        }

        // Track add to cart
        async function trackAddToCart() {
            if (!paSDK) {
                alert('Please initialize SDK first');
                return;
            }

            try {
                const clickId = paSDK._generateId();
                await paSDK.trackAddToCart({
                    product: {
                        refId: 'PROD-001',
                        quantity: 1,
                        price: 79.99
                    },
                    clickId: clickId
                });
                
                logToConsole('event', 'Add to cart tracked');
                alert('Add to cart tracked successfully!');
            } catch (error) {
                logToConsole('error', 'Failed to track add to cart:', error);
            }
        }

        // Track checkout
        async function trackCheckout() {
            if (!paSDK) {
                alert('Please initialize SDK first');
                return;
            }

            try {
                await paSDK.trackCheckout({
                    subTotal: 169.98,
                    discount: 10.00,
                    totalPrice: 159.98,
                    deliveryFee: 0,
                    currencyCode: 'USD',
                    products: [
                        { refId: 'PROD-001', quantity: 1, price: 79.99 },
                        { refId: 'PROD-003', quantity: 1, price: 89.99 }
                    ]
                });
                
                logToConsole('event', 'Checkout tracked');
                alert('Checkout tracked successfully!');
            } catch (error) {
                logToConsole('error', 'Failed to track checkout:', error);
            }
        }

        // Track purchase
        async function trackPurchase() {
            if (!paSDK) {
                alert('Please initialize SDK first');
                return;
            }

            try {
                await paSDK.trackPurchase({
                    orderId: 'ORD-' + Date.now(),
                    paymentMethod: 'credit_card',
                    currencyCode: 'USD',
                    products: [
                        { refId: 'PROD-001', quantity: 1, price: 79.99 },
                        { refId: 'PROD-003', quantity: 1, price: 89.99 }
                    ]
                });
                
                logToConsole('event', 'Purchase tracked');
                alert('Purchase tracked successfully!');
            } catch (error) {
                logToConsole('error', 'Failed to track purchase:', error);
            }
        }

        // Track search
        async function trackSearch() {
            if (!paSDK) {
                alert('Please initialize SDK first');
                return;
            }

            const searchTerm = prompt('Enter search term:') || 'headphones';
            
            try {
                await paSDK.trackSearch({
                    searchTerm: searchTerm,
                    numberOfResults: 42,
                    widgetId: 'search-widget',
                    routeId: 'search-route',
                    tacticId: 'search-tactic',
                    campaignId: 'search-campaign',
                    recommenderId: 'search-recommender'
                });
                
                logToConsole('event', `Search tracked: "${searchTerm}"`);
                alert('Search tracked successfully!');
            } catch (error) {
                logToConsole('error', 'Failed to track search:', error);
            }
        }

        // Track click
        async function trackClick() {
            if (!paSDK) {
                alert('Please initialize SDK first');
                return;
            }

            try {
                await paSDK.trackClick({
                    refId: 'PROD-001',
                    actionType: 1, // OpenProductPage
                    contextType: 1, // RecommendationWidget
                    contextId: 'widget-123',
                    clickPosition: 1,
                    widgetId: 'widget-123',
                    routeId: 'route-456'
                });
                
                logToConsole('event', 'Click tracked');
                alert('Click tracked successfully!');
            } catch (error) {
                logToConsole('error', 'Failed to track click:', error);
            }
        }

        // Track impression
        async function trackImpression() {
            if (!paSDK) {
                alert('Please initialize SDK first');
                return;
            }

            try {
                await paSDK.trackSlotImpression({
                    refId: 'PROD-001',
                    widgetId: 'widget-123',
                    routeId: 'route-456',
                    tacticId: 'tactic-789',
                    campaignId: 'campaign-abc',
                    recommenderId: 'recommender-xyz'
                });
                
                logToConsole('event', 'Impression tracked');
                alert('Impression tracked successfully!');
            } catch (error) {
                logToConsole('error', 'Failed to track impression:', error);
            }
        }

        // Helper functions
        function selectProduct(refId) {
            const product = sampleProducts.find(p => p.refId === refId);
            logToConsole('info', `Selected product: ${product.name} (${refId})`);
            
            if (paSDK) {
                paSDK.trackViewProduct({ refId: refId });
            }
        }

        function addToCart(refId, price) {
            const product = sampleProducts.find(p => p.refId === refId);
            logToConsole('info', `Added to cart: ${product.name} (${refId})`);
            
            if (paSDK) {
                paSDK.trackAddToCart({
                    product: { refId: refId, quantity: 1, price: price },
                    clickId: paSDK._generateId()
                });
            }
        }

        // Console logging
        function logToConsole(type, message, data) {
            const time = new Date().toLocaleTimeString();
            const entry = { time, type, message, data };
            consoleLog.push(entry);
            
            // Keep only last 50 entries
            if (consoleLog.length > 50) {
                consoleLog.shift();
            }
            
            updateConsoleDisplay();
        }

        function updateConsoleDisplay() {
            const output = document.getElementById('console-output');
            output.innerHTML = consoleLog.map(entry => {
                let html = `<div class="log-entry">`;
                html += `<span class="log-time">[${entry.time}]</span> `;
                html += `<span class="log-type ${entry.type}">${entry.type.toUpperCase()}:</span> `;
                html += `${entry.message}`;
                if (entry.data) {
                    html += ` ${JSON.stringify(entry.data, null, 2)}`;
                }
                html += `</div>`;
                return html;
            }).join('');
            
            // Scroll to bottom
            output.scrollTop = output.scrollHeight;
        }

        // Initialize on load
        window.addEventListener('DOMContentLoaded', () => {
            initializeSampleProducts();
            logToConsole('info', 'Page loaded, ready to initialize SDK');
        });
    </script>
</body>
</html>